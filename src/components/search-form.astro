---
import { t } from '~/i18n'
import { getPreferredLanguage } from '~/utils/language'

interface Props {
  matchPartial?: boolean
  query?: string | null
  autoFocus?: boolean
}

const { matchPartial = false, query, autoFocus = true } = Astro.props

const acceptLanguage = Astro.request.headers.get('accept-language')
const userLanguage = getPreferredLanguage(acceptLanguage)
---

<form action="/search" method="get" role="search">
  <fieldset>
    <label for="search-input" class="sr-only"
      >{t(userLanguage, 'search:search')}</label
    >
    <input
      id="search-input"
      type="search"
      placeholder={`${t(userLanguage, 'search:search')}â€¦`}
      autocomplete="off"
      autocorrect="off"
      autocapitalize="off"
      name="query"
      required
      autofocus={autoFocus}
      value={query}
    />
    <button aria-label={t(userLanguage, 'search:search')} type="submit"
      >ðŸ”Ž</button
    >
  </fieldset>
  <label>
    {t(userLanguage, 'search:matchPartial')}
    <input
      type="checkbox"
      name="matchpartial"
      value="true"
      checked={matchPartial}
    />
  </label>
</form>

<style>
  form {
    display: flex;
    flex-direction: column;
    flex-wrap: wrap;
    gap: 0.5rem;

    fieldset {
      display: flex;
      flex: 1;
      margin: 0;
      padding: 0.4rem;
      border: 1px solid;
      border-radius: var(--rounding);
      border-color: var(--bg-alt-4);

      &:focus-within {
        border-color: inherit;
      }

      input {
        width: 100%;
        border: none;
        background-color: inherit;
        color: inherit;
        font-size: large;

        &:focus {
          outline: none;
        }
      }

      button {
        border: none;
        background: none;
        font-size: inherit;
        cursor: pointer;
      }
    }

    > label {
      display: flex;
      align-items: center;
      align-self: end;
      gap: 0.25rem;
      white-space: nowrap;
      cursor: pointer;
    }
  }
</style>

<script>
  'use strict'

  const popover = document.getElementById('search-modal')

  document.addEventListener('keydown', function (event) {
    if (popover && (event.metaKey || event.ctrlKey) && event.key === 'k') {
      event.preventDefault()
      popover.togglePopover()
    }
  })
</script>
