---
import TextMetaContent from '../components/text-meta-content.astro'
import Layout from '../layouts/Layout.astro'

const { chapter } = Astro.params
const chosenLanguage = 'en' // TODO: lol

const suttaplexResponse = await fetch(
  `https://suttacentral.net/api/suttaplex/${chapter}?language=${chosenLanguage}`
)
const suttaplexData = await suttaplexResponse.json()

const crumbsResponse = await fetch(
  `https://suttacentral.net/api/navigation_data/${chapter}?language=${chosenLanguage}`
)
const crumbsData = await crumbsResponse.json()

const isPatimokkha = chapter?.endsWith('-pm')
---

<Layout breadcrumbs={crumbsData}>
  <article>
    <ol>
      {
        (isPatimokkha ? [suttaplexData[0]] : suttaplexData).map(entry => (
          <TextMetaContent data={entry} chosenLanguage={chosenLanguage} />
        ))
      }
      {
        isPatimokkha && (
          <details class="patimokkha-details">
            <summary>Show parallels and details</summary>
            {suttaplexData.slice(1).map(entry => (
              <TextMetaContent data={entry} chosenLanguage={chosenLanguage} />
            ))}
          </details>
        )
      }
    </ol>
  </article>
</Layout>
