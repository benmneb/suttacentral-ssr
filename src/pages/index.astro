---
import { t } from '~/i18n'
import Layout from '~/layouts/Layout.astro'
import { getPreferredLanguage } from '~/utils/language'

const acceptLanguage = Astro.request.headers.get('accept-language')
const userLanguage = getPreferredLanguage(acceptLanguage)

const response = await fetch(
  `https://suttacentral.net/api/menu?language=${userLanguage}`
)
const json = await response.json()
const tipitaka = json
  .filter(m => ['sutta', 'vinaya', 'abhidhamma'].includes(m.uid))
  .reverse()
---

<Layout>
  <main>
    <h1 set:html={t(userLanguage, 'home:1')} />
    <ol>
      {
        tipitaka.map(pitaka => (
          <li>
            <article>
              <h2>
                <a
                  href={`/pitaka/${pitaka.uid}`}
                  set:text={`${pitaka.root_name}${pitaka.root_name && pitaka.translated_name ? 'â€”' : ''}${pitaka.translated_name || ''}`}
                />
              </h2>
              {!!pitaka.blurb && <p set:html={pitaka.blurb} />}
            </article>
          </li>
        ))
      }
    </ol>
  </main>
</Layout>
